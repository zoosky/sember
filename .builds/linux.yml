image: alpine/latest
oauth: pages.sr.ht/PAGES:RW
packages:
  - curl
  - hut
environment:
  site: asko.srht.site
sources:
  - https://git.sr.ht/~asko/sember
tasks:
  - setup: curl https://sh.rustup.rs -sSf | sh -s -- -y
  - build: |
      cd sember
      PATH="$HOME/.cargo/bin:$PATH" cargo build --release
      ls -la
      cd target
      ls -la
      cd release
      ls -la
  - deploy: |
      mkdir $site/bin
      mkdir $site/bin/sember
      ls -la
      mv /home/build/sember/target/release/sember $site/bin/sember/sember-linux
      tar -C $site -cvz . > site.tar.gz
      hut pages publish -d $site site.tar.gz